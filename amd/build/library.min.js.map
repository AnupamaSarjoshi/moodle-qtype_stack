{"version":3,"file":"library.min.js","sources":["../src/library.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handle requests for library question info.\n *\n * @module     qtype_stack/input\n * @copyright  2018 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'core/ajax',\n    'core_filters/events'\n], function(\n    Ajax,\n    CustomEvents\n) {\n\n    var contextId = null;\n    var libraryDiv = null;\n\n    /**\n     *\n     * @param {?int} cId\n     * @param {?string} lDiv\n     */\n    function setup(cId, lDiv) {\n        contextId = cId;\n        libraryDiv = document.getElementById(lDiv);\n        let linksArray = document.querySelectorAll(\".library-file-link\");\n        linksArray.forEach(function(elem) {\n            elem.addEventListener(\"click\", libraryRender);\n        });\n    }\n\n    /**\n     *\n     * @param {*} filepath\n     */\n    function libraryRender(e) {\n        const filepath = e.target.getAttribute('data-filepath');\n        libraryDiv.classList.add('loading');\n        Ajax.call([{\n            methodname: 'qtype_stack_library_render',\n            args: {context: contextId, filepath: filepath},\n            done: function(response) {\n                libraryDiv.classList.remove('loading');\n                showResults(response);\n            },\n            fail: function(response) {\n                libraryDiv.classList.remove('loading');\n                showFailure(response);\n            }\n        }]);\n    }\n\n    /**\n     *\n     * @param {*} response\n     * @returns {boolean} true\n     */\n    function showResults(response) {\n        libraryDiv.innerHTML = response.questionrender;\n        // This fires the Maths filters for content in the validation div.\n        CustomEvents.notifyFilterContentUpdated(libraryDiv);\n        return true;\n    }\n\n    /**\n     *\n     * @param {*} response\n     */\n    function showFailure(response) {\n        libraryDiv.innerHTML = 'Something went wrong. ' + JSON.stringify(response);\n    }\n\n    /** Export our entry point. */\n    return {\n        setup: setup\n    };\n});\n"],"names":["define","Ajax","CustomEvents","contextId","libraryDiv","libraryRender","e","filepath","target","getAttribute","classList","add","call","methodname","args","context","done","response","remove","innerHTML","questionrender","notifyFilterContentUpdated","showResults","fail","JSON","stringify","showFailure","setup","cId","lDiv","document","getElementById","querySelectorAll","forEach","elem","addEventListener"],"mappings":";;;;;;;AAsBAA,6BAAO,CACH,YACA,wBACD,SACCC,KACAC,kBAGIC,UAAY,KACZC,WAAa,cAoBRC,cAAcC,SACbC,SAAWD,EAAEE,OAAOC,aAAa,iBACvCL,WAAWM,UAAUC,IAAI,WACzBV,KAAKW,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CAACC,QAASZ,UAAWI,SAAUA,UACrCS,KAAM,SAASC,UACXb,WAAWM,UAAUQ,OAAO,oBAenBD,UACjBb,WAAWe,UAAYF,SAASG,eAEhClB,aAAamB,2BAA2BjB,YAjBhCkB,CAAYL,WAEhBM,KAAM,SAASN,UACXb,WAAWM,UAAUQ,OAAO,oBAsBnBD,UACjBb,WAAWe,UAAY,yBAA2BK,KAAKC,UAAUR,UAtBzDS,CAAYT,oBA0BjB,CACHU,eApDWC,IAAKC,MAChB1B,UAAYyB,IACZxB,WAAa0B,SAASC,eAAeF,MACpBC,SAASE,iBAAiB,sBAChCC,SAAQ,SAASC,MACxBA,KAAKC,iBAAiB,QAAS9B"}