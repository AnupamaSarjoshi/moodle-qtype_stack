{"version":3,"file":"library.min.js","sources":["../src/library.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handle requests for library question info.\n *\n * @module     qtype_stack/input\n * @copyright  2018 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'core/ajax',\n    'core_filters/events'\n], function(\n    Ajax,\n    CustomEvents\n) {\n\n    let categoryId = null;\n    let libraryDiv = null;\n    let rawDiv = null;\n    let variablesDiv = null;\n    let importListDiv = null;\n    let displayedDiv = null;\n    let currentPath = null;\n\n    /**\n     *\n     * @param {?int} cId\n     * @param {?string} lDiv\n     */\n    function setup(cId) {\n        categoryId = cId;\n        libraryDiv = document.querySelector('.stack_library_display');\n        rawDiv = document.querySelector('.stack_library_raw_display');\n        variablesDiv = document.querySelector('.stack_library_variables_display');\n        importListDiv = document.querySelector('.stack-library-imported-list');\n        displayedDiv = document.querySelector('.stack_library_selected_question');\n        const linksArray = document.querySelectorAll('.library-file-link');\n        linksArray.forEach(function(elem) {\n            elem.addEventListener('click', libraryRender);\n        });\n        const importButton = document.querySelector('.library-import-link');\n        importButton.addEventListener('click', libraryImport);\n    }\n\n    /**\n     *\n     * @param {*} filepath\n     */\n    function libraryRender(e) {\n        const filepath = e.target.getAttribute('data-filepath');\n        currentPath = filepath;\n        libraryDiv.classList.add('loading');\n        Ajax.call([{\n            methodname: 'qtype_stack_library_render',\n            args: {category: categoryId, filepath: filepath},\n            done: function(response) {\n                libraryDiv.classList.remove('loading');\n                showResults(response);\n            },\n            fail: function(response) {\n                libraryDiv.classList.remove('loading');\n                showFailure(response);\n            }\n        }]);\n    }\n\n    /**\n     *\n     * @param {*} response\n     * @returns {boolean} true\n     */\n    function showResults(response) {\n        libraryDiv.innerHTML = response.questionrender;\n        rawDiv.innerHTML = response.questiontext;\n        variablesDiv.innerHTML = response.questionvariables;\n        displayedDiv.innerHTML = currentPath.split('/').pop();\n        // This fires the Maths filters for content in the validation div.\n        CustomEvents.notifyFilterContentUpdated(libraryDiv);\n        return true;\n    }\n\n    /**\n     *\n     * @param {*} response\n     */\n    function showFailure(response) {\n        libraryDiv.innerHTML = 'Something went wrong. ' + JSON.stringify(response);\n    }\n\n    /** Export our entry point. */\n    return {\n        setup: setup\n    };\n\n        /**\n     *\n     * @param {*} filepath\n     */\n        function libraryImport(e) {\n            if (!currentPath) {\n                return;\n            }\n            document.querySelector('.stack-library-error').hidden = true;\n            const filepath = currentPath;\n            libraryDiv.classList.add('loading');\n            Ajax.call([{\n                methodname: 'qtype_stack_library_import',\n                args: {category: categoryId, filepath: filepath},\n                done: function(response) {\n                    if (response.success) {\n                        importListDiv.innerHTML = importListDiv.innerHTML + '<br>' + currentPath.split('/').pop();\n                    } else {\n                        document.querySelector('.stack-library-error').hidden = false;\n                    }\n                },\n                fail: function() {\n                    document.querySelector('.stack-library-error').hidden = false;\n                }\n            }]);\n        }\n});\n"],"names":["define","Ajax","CustomEvents","categoryId","libraryDiv","rawDiv","variablesDiv","importListDiv","displayedDiv","currentPath","libraryRender","e","filepath","target","getAttribute","classList","add","call","methodname","args","category","done","response","remove","innerHTML","questionrender","questiontext","questionvariables","split","pop","notifyFilterContentUpdated","showResults","fail","JSON","stringify","showFailure","setup","cId","document","querySelector","querySelectorAll","forEach","elem","addEventListener","libraryImport","hidden","success"],"mappings":";;;;;;;AAsBAA,6BAAO,CACH,YACA,wBACD,SACCC,KACAC,kBAGIC,WAAa,KACbC,WAAa,KACbC,OAAS,KACTC,aAAe,KACfC,cAAgB,KAChBC,aAAe,KACfC,YAAc,cA0BTC,cAAcC,SACbC,SAAWD,EAAEE,OAAOC,aAAa,iBACvCL,YAAcG,SACdR,WAAWW,UAAUC,IAAI,WACzBf,KAAKgB,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CAACC,SAAUjB,WAAYS,SAAUA,UACvCS,KAAM,SAASC,UACXlB,WAAWW,UAAUQ,OAAO,oBAenBD,UACjBlB,WAAWoB,UAAYF,SAASG,eAChCpB,OAAOmB,UAAYF,SAASI,aAC5BpB,aAAakB,UAAYF,SAASK,kBAClCnB,aAAagB,UAAYf,YAAYmB,MAAM,KAAKC,MAEhD3B,aAAa4B,2BAA2B1B,YApBhC2B,CAAYT,WAEhBU,KAAM,SAASV,UACXlB,WAAWW,UAAUQ,OAAO,oBAyBnBD,UACjBlB,WAAWoB,UAAY,yBAA2BS,KAAKC,UAAUZ,UAzBzDa,CAAYb,oBA6BjB,CACHc,eA9DWC,KACXlC,WAAakC,IACbjC,WAAakC,SAASC,cAAc,0BACpClC,OAASiC,SAASC,cAAc,8BAChCjC,aAAegC,SAASC,cAAc,oCACtChC,cAAgB+B,SAASC,cAAc,gCACvC/B,aAAe8B,SAASC,cAAc,oCACnBD,SAASE,iBAAiB,sBAClCC,SAAQ,SAASC,MACxBA,KAAKC,iBAAiB,QAASjC,kBAEd4B,SAASC,cAAc,wBAC/BI,iBAAiB,QAASC,0BAyD9BA,cAAcjC,OACdF,mBAGL6B,SAASC,cAAc,wBAAwBM,QAAS,QAClDjC,SAAWH,YACjBL,WAAWW,UAAUC,IAAI,WACzBf,KAAKgB,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CAACC,SAAUjB,WAAYS,SAAUA,UACvCS,KAAM,SAASC,UACPA,SAASwB,QACTvC,cAAciB,UAAYjB,cAAciB,UAAY,OAASf,YAAYmB,MAAM,KAAKC,MAEpFS,SAASC,cAAc,wBAAwBM,QAAS,GAGhEb,KAAM,WACFM,SAASC,cAAc,wBAAwBM,QAAS"}