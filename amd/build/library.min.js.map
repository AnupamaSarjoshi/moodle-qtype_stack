{"version":3,"file":"library.min.js","sources":["../src/library.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handle requests for library question info.\n *\n * @module     qtype_stack/input\n * @copyright  2018 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'core/ajax',\n    'core_filters/events'\n], function(\n    Ajax,\n    CustomEvents\n) {\n\n    let categoryId = null;\n    let libraryDiv = null;\n    let currentPath = null;\n\n\n    /**\n     *\n     * @param {?int} cId\n     * @param {?string} lDiv\n     */\n    function setup(cId, lDiv) {\n        categoryId = cId;\n        libraryDiv = document.getElementById(lDiv);\n        const linksArray = document.querySelectorAll(\".library-file-link\");\n        linksArray.forEach(function(elem) {\n            elem.addEventListener(\"click\", libraryRender);\n        });\n        const importButton = document.querySelector(\".library-import-link\");\n        importButton.addEventListener(\"click\", libraryImport);\n    }\n\n    /**\n     *\n     * @param {*} filepath\n     */\n    function libraryRender(e) {\n        const filepath = e.target.getAttribute('data-filepath');\n        currentPath = filepath;\n        libraryDiv.classList.add('loading');\n        Ajax.call([{\n            methodname: 'qtype_stack_library_render',\n            args: {category: categoryId, filepath: filepath},\n            done: function(response) {\n                libraryDiv.classList.remove('loading');\n                showResults(response);\n            },\n            fail: function(response) {\n                libraryDiv.classList.remove('loading');\n                showFailure(response);\n            }\n        }]);\n    }\n\n    /**\n     *\n     * @param {*} response\n     * @returns {boolean} true\n     */\n    function showResults(response) {\n        libraryDiv.innerHTML = response.questionrender;\n        // This fires the Maths filters for content in the validation div.\n        CustomEvents.notifyFilterContentUpdated(libraryDiv);\n        return true;\n    }\n\n    /**\n     *\n     * @param {*} response\n     */\n    function showFailure(response) {\n        libraryDiv.innerHTML = 'Something went wrong. ' + JSON.stringify(response);\n    }\n\n    /** Export our entry point. */\n    return {\n        setup: setup\n    };\n\n        /**\n     *\n     * @param {*} filepath\n     */\n        function libraryImport(e) {\n            if (!currentPath) {\n                return;\n            }\n            const filepath = currentPath;\n            libraryDiv.classList.add('loading');\n            Ajax.call([{\n                methodname: 'qtype_stack_library_import',\n                args: {category: categoryId, filepath: filepath},\n                done: function(response) {\n                    console.log('Success');\n                },\n                fail: function(response) {\n                    console.log('Failure');\n                }\n            }]);\n        }\n});\n"],"names":["define","Ajax","CustomEvents","categoryId","libraryDiv","currentPath","libraryRender","e","filepath","target","getAttribute","classList","add","call","methodname","args","category","done","response","remove","innerHTML","questionrender","notifyFilterContentUpdated","showResults","fail","JSON","stringify","showFailure","setup","cId","lDiv","document","getElementById","querySelectorAll","forEach","elem","addEventListener","querySelector","libraryImport","console","log"],"mappings":";;;;;;;AAsBAA,6BAAO,CACH,YACA,wBACD,SACCC,KACAC,kBAGIC,WAAa,KACbC,WAAa,KACbC,YAAc,cAuBTC,cAAcC,SACbC,SAAWD,EAAEE,OAAOC,aAAa,iBACvCL,YAAcG,SACdJ,WAAWO,UAAUC,IAAI,WACzBX,KAAKY,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CAACC,SAAUb,WAAYK,SAAUA,UACvCS,KAAM,SAASC,UACXd,WAAWO,UAAUQ,OAAO,oBAenBD,UACjBd,WAAWgB,UAAYF,SAASG,eAEhCnB,aAAaoB,2BAA2BlB,YAjBhCmB,CAAYL,WAEhBM,KAAM,SAASN,UACXd,WAAWO,UAAUQ,OAAO,oBAsBnBD,UACjBd,WAAWgB,UAAY,yBAA2BK,KAAKC,UAAUR,UAtBzDS,CAAYT,oBA0BjB,CACHU,eAvDWC,IAAKC,MAChB3B,WAAa0B,IACbzB,WAAa2B,SAASC,eAAeF,MAClBC,SAASE,iBAAiB,sBAClCC,SAAQ,SAASC,MACxBA,KAAKC,iBAAiB,QAAS9B,kBAEdyB,SAASM,cAAc,wBAC/BD,iBAAiB,QAASE,0BAsD9BA,cAAc/B,OACdF,yBAGCG,SAAWH,YACjBD,WAAWO,UAAUC,IAAI,WACzBX,KAAKY,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CAACC,SAAUb,WAAYK,SAAUA,UACvCS,KAAM,SAASC,UACXqB,QAAQC,IAAI,YAEhBhB,KAAM,SAASN,UACXqB,QAAQC,IAAI"}