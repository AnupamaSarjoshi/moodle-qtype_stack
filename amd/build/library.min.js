/**
 * A javascript module to handle requests for library question info.
 *
 * @module     qtype_stack/input
 * @copyright  2018 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_stack/library",["core/ajax","core_filters/events"],(function(Ajax,CustomEvents){let categoryId=null,libraryDiv=null,rawDiv=null,variablesDiv=null,importListDiv=null,displayedDiv=null,currentPath=null;function libraryRender(e){const filepath=e.target.getAttribute("data-filepath");currentPath=filepath,libraryDiv.classList.add("loading"),Ajax.call([{methodname:"qtype_stack_library_render",args:{category:categoryId,filepath:filepath},done:function(response){libraryDiv.classList.remove("loading"),function(response){libraryDiv.innerHTML=response.questionrender,rawDiv.innerHTML=response.questiontext,variablesDiv.innerHTML=response.questionvariables,displayedDiv.innerHTML=currentPath.split("/").pop(),CustomEvents.notifyFilterContentUpdated(libraryDiv)}(response)},fail:function(response){libraryDiv.classList.remove("loading"),function(response){libraryDiv.innerHTML="Something went wrong. "+JSON.stringify(response)}(response)}}])}return{setup:function(cId){categoryId=cId,libraryDiv=document.querySelector(".stack_library_display"),rawDiv=document.querySelector(".stack_library_raw_display"),variablesDiv=document.querySelector(".stack_library_variables_display"),importListDiv=document.querySelector(".stack-library-imported-list"),displayedDiv=document.querySelector(".stack_library_selected_question"),document.querySelectorAll(".library-file-link").forEach((function(elem){elem.addEventListener("click",libraryRender)})),document.querySelector(".library-import-link").addEventListener("click",libraryImport)}};function libraryImport(e){if(!currentPath)return;document.querySelector(".stack-library-error").hidden=!0;const filepath=currentPath;libraryDiv.classList.add("loading"),Ajax.call([{methodname:"qtype_stack_library_import",args:{category:categoryId,filepath:filepath},done:function(response){response.success?importListDiv.innerHTML=importListDiv.innerHTML+"<br>"+currentPath.split("/").pop():document.querySelector(".stack-library-error").hidden=!1},fail:function(){document.querySelector(".stack-library-error").hidden=!1}}])}}));

//# sourceMappingURL=library.min.js.map